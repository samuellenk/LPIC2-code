---
title: "Praxis-Beispiel: Bind-Konfiguration und -Zonen mit Master & Slave ![](images/LPIC2_logo.png){width=20 height=20}"
subtitle: "LPIC 2"
author: "![SL](images/SL_foto_300.png){width=20 height=20} [&copy; Samuel Lenk](https://linux-trainings.de/)"
theme: "Luebeck"
colortheme: "whale"
aspectratio: 169
colorlinks: true
urlcolor: gray
linkcolor: gray
---

# Einleitung

- der **Umfang:** dieser Übung beinhaltet die Themen LPIC‑2 207.1 und 207.2

# Voraussetzungen

## zwei VMs mit statischen IPs

| VM-Name             | statische IP | Distribution | Rolle  |
|---------------------|--------------|--------------|--------|
| **ns1.example.net** | `172.16.0.2` | Debian 13    | Master |
| **ns2.example.net** | `172.16.0.3` | RHEL 10      | Slave  |

## Firewall-Freigabe

```bash
# Firewall‑Regeln öffnen (falls aktiv) auf Debian (ufw):
sudo ufw allow 53/tcp && sudo ufw allow 53/udp
# RHEL (firewalld):
sudo firewall-cmd --add-service=dns --permanent && sudo firewall-cmd --reload
```

## Test der Voraussetzungen

- `ping` sollte in beiden Richtungen möglich sein
- mit `nc` sollte eine Verbindung zum Port 53 **noch nicht** möglich sein

# Setup auf `ns1` (Master)

## Installation

```bash
# BIND + Hilfsprogramme installieren
sudo apt update && sudo apt install -y bind9 bind9utils dnsutils
# Service-Status abfragen
sudo systemctl status bind9
```

## Zonen-Konfiguration

Verzeichnis anlegen:
```bash
sudo mkdir -p /etc/bind/zones
```

Konfiguration der Zonen:
```bash
cat <<'EOF' | sudo tee -a /etc/bind/named.conf.local
// ----- LPIC‑2 MASTER ZONEN -----
zone "example.net" IN {
    type master;
    file "/etc/bind/zones/db.example.net";
    allow-transfer { 172.16.0.3; }; // Slave-IP
    also-notify { 172.16.0.3; };
};
zone "0.16.172.in-addr.arpa" IN {
    type master;
    file "/etc/bind/zones/db.172.16.0";
    allow-transfer { 172.16.0.3; };
    also-notify { 172.16.0.3; };
};
// ----- ENDE -----
EOF
```

## Zonen erstellen

Forward‑Lookup‑Zone:
```bash
sudo tee /etc/bind/zones/db.example.net > /dev/null <<'EOF'
$TTL    86400
@       IN      SOA     ns1.example.net. admin.example.net. (
                              2024010101 ; serial
                              3600       ; refresh
                              1800       ; retry
                              604800     ; expire
                              86400 )    ; minimum
        IN      NS      ns1.example.net.
        IN      NS      ns2.example.net.
ns1     IN      A       172.16.0.2
ns2     IN      A       172.16.0.3
www     IN      A       172.16.0.4
web     IN      CNAME   172.16.0.4
mta     IN      A       172.16.0.6
EOF
```

Reverse‑Lookup‑Zone:
```bash
sudo tee /etc/bind/zones/db.172.16.0 > /dev/null <<'EOF'
$TTL    86400
@       IN      SOA     ns1.example.net. admin.example.net. (
                              2024010101 ; serial
                              3600       ; refresh
                              1800       ; retry
                              604800     ; expire
                              86400 )    ; minimum
        IN      NS      ns1.example.net.
        IN      NS      ns2.example.net.
2       IN      PTR     ns1.example.net.
3       IN      PTR     ns2.example.net.
4       IN      PTR     www.example.net.
6       IN      PTR     mta.example.net.
EOF
```

## Setup prüfen

Syntax‑Check:
```bash
sudo named-checkconf -z /etc/bind/named.conf
sudo named-checkzone example.net /etc/bind/zones/db.example.net
sudo named-checkzone 0.16.172.in-addr.arpa /etc/bind/zones/db.172.16.0
```

Konfiguration laden:
```bash
sudo rndc reload
```

# Setup auf `ns2` (Slave)

## Installation

```bash
# BIND + Tools installieren
sudo dnf install -y bind bind-utils
# Service aktivieren & starten
sudo systemctl enable --now named
```

## Zonen-Konfiguration

Verzeichnis anlegen:
```bash
sudo mkdir -p /var/named/zones
```

Konfiguration der Zonen:
```bash
cat <<'EOF' | sudo tee -a /etc/named.conf
// ----- LPIC‑2 SLAVE ZONEN -----
zone "example.net" IN {
    type slave;
    masters { 172.16.0.2; };
    file "zones/db.example.net";
};
zone "0.16.172.in-addr.arpa" IN {
    type slave;
    masters { 172.16.0.2; };
    file "zones/db.172.16.0";
};
// ----- ENDE -----
EOF
```

## Setup prüfen

Syntax‑Check (Trockenlauf):
```bash
sudo named-checkconf -z /etc/named.conf
```

Transfer erzwingen, um die Synchronisation zu prüfen:
```bash
sudo rndc reload # auf Master
dig axfr example.net @localhost # auf Slave
```
- diese Form von dig gibt die gesamte Zone aus
- gut zum testen; sollte man aber noch einschränken

übertragene Dateien prüfen:
```bash
ls -l /var/named/zones/
```

## was auf dem Slave fehlte

Stand 11.02.2026 fehlte folgendes auf dem Slave-Server:

- `allow query` für Subnetz in `named.conf`
- `listen on` für lokales Interface in `named.conf`
- Port 53 (tcp,udp) in Firewall dauerhaft zulassen
- Berechtigungen auf Ordner `zones` anpassen: `chown named:named /var/bind/zones`

# DNS‑Setup testen

auf Master (`ns1`) gesamte Zone ausgeben:
```bash
dig axfr example.net @172.16.0.3
```
- veranlasst gleichzeitig einen Zonentransfer

auf einem beliebigen Host, zum Beispiel `ns1`:
```bash
# Test auf dem Master
# Vorwärtsauflösung:
dig @172.16.0.2 www.example.net +short # → 172.16.0.10
# Rückwärtsauflösung:
dig @172.16.0.2 -x 172.16.0.4 +short # → www.example.net.

# Test auf dem Slave
# Vorwärtsauflösung:
dig @172.16.0.3 www.example.net +short # → 172.16.0.10
# Rückwärtsauflösung:
dig @172.16.0.3 -x 172.16.0.4 +short # → www.example.net.
```

Zone im `raw`-Format auf Secondary auslesen:
```bash
named-compilezone -f raw -F text -o db.example.net.text example.net db.example.net
```

# Weitere Punkte

1. auf den Name-Servern & Clients die zu verwendenden Name-Server jeweils setzen

2. Konfiguration vom `logging` in `named.conf.local`:
```bash
logging {
        ...
        channel queries_log {
                file "log/queries" versions 600 size 20m;
                print-time yes;
                print-category yes;
                print-severity yes;
                severity info;
        };

        category queries { queries_log; };
};
```

3. Konfiguration von `forwarders` in `named.conf.options`:
```bash
options {
        ...
        forwarders {
                1.1.1.1; 8.8.8.8;
        };
};
```

4. lokalen Nameserver ändern:
```bash
echo "nameserver 172.16.0.2" | sudo tee /etc/resolv.conf
```

# Weitere Befehle und Themen

- `rndc freeze` / `rndc thaw` – sichere Zone‑Updates während Bearbeitung
- komplette Auflösungskette anzeigen: `dig +trace example.net`
- ACL verwenden
- Absicherung mit DNSSEC
- Absicherung mit TSIG
- Aufteilung der Bind-Konfiguration (Split)
