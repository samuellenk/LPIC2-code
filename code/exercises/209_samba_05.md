---
title: "Praxis-Beispiel: Samba-Server-Konfiguration ![](images/LPIC2_logo.png){width=20 height=20}"
subtitle: "LPIC 2"
author: "![SL](images/SL_foto_300.png){width=20 height=20} [&copy; Samuel Lenk](https://linux-trainings.de/)"
theme: "Luebeck"
colortheme: "whale"
aspectratio: 169
colorlinks: true
urlcolor: gray
linkcolor: gray
---

# Einleitung

Dieser Abschnitt bietet ein grundlegendes, eigenständiges Beispiel zur Verwendung vom Samba-Server. Der Samba-Server wird dazu als Standalone-Instanz betrieben.

# Voraussetzung

- zwei Systeme (VMs)
- Samba-Server auf Debian 13
- Samba-Client auf LinuxMint 10
- die Schritte sollten aber (nahezu) deckungsgleich auf anderen Distributionen anwendbar sein

# Installation

Samba-Server installieren:
```bash
sudo apt update
sudo apt install samba
```

Paket-Inhalte auflisten
```bash
dpkg -L samba
```
- hier lohnt sich ein Blick auf die enthaltenen *Executables*
- aber auch diverse *Man-Pages* sind enthalten
- und *Beispiele* unter `/usr/share/doc`

Dienste prüfen:
```bash
systemctl status smbd nmbd
```

Client installieren:
```bash
sudo apt install smbclient
```

# grundlegende Konfiguration

allgemeine Einstellungen in `/etc/samba/smb.conf`:
```bash
[global]
    workgroup = WORKGROUP
    log file = /var/log/samba/log.%m
    max log size = 1000
    logging = file
    panic action = /usr/share/samba/panic-action %d
    server role = standalone server
    security = user
    guest account = nobody
    hide files = *.tmp *.bak *.old
```

# Share konfigurieren

erster öffentlicher Share in `/etc/samba/smb.conf`:
```bash
[public]
    path = /public
    read only = Yes
    browseable = Yes
    guest ok = Yes
```

# Share-Ordner anlegen

```bash
sudo mkdir -m 0777 /public
sudo chown nobody:nogroup /public
echo "eine Datei im Samba Share" > /public/file.txt
```

# Konfiguration prüfen

```bash
testparm /etc/samba/smb.conf
# Quick Check:
testparm -s /etc/samba/smb.conf
```

# Dienst neu starten

mehrere Wege:
```bash
# mit systemctl:
systemctl restart smbd
systemctl restart nmbd
# smbcontrol reload
smbcontrol smbd reload-config
smbcontrol nmbd reload-config
smbcontrol all reload-config
```

# Share testen

erster Test auf dem **Server**:
```bash
smbclient //localhost/public -N -U% -c 'ls'
```

Test auf dem **Client**:
```bash
# Installation:
sudo apt update && sudo apt install samba-client -y
# Verbindung herstellen:
smbclient //smb.example.net/public ~/public
# öffnet eine interaktive Samba-Shell:
Anonymous login successful
Try "help" to get a list of possible commands.
smb: \> ls
# einfach verfügbare Befehle mit "help" anzeigen
# und einige ausprobieren
```

# Troubleshooting

Logs:
```bash
# Pfad für Logging ist `log file` in smb.conf
ls -l /var/log/samba/
tail /var/log/samba/*
# grep ...
```

# weiteren Share konfigurieren

dieser Share ist nur mit Authentifizierung verwendbar:
```bash
[shared]
    path = /shared
    read only = no
    valid users = @sambashare
    create mask = 0660
    directory mask = 2770
```
- Eintrag in `/etc/samba/smb.conf`

# weiteren Share-Ordner anlegen

```bash
mkdir -m 2770 /shared
chown root:sambashare /shared
echo "Share mit Authentifizierung" | sudo tee /shared/auth.txt
```

# User konfigurieren

zwei User mit identischer Konfiguration:
```bash
adduser alice
adduser frank
smbpasswd -a alice
smbpasswd -a frank
usermod -aG sambashare alice
usermod -aG sambashare frank
# falls nicht vorhanden die Gruppe `sambashare` anlegen
```
- nicht vergessen den [Dienst neu zu starten](#dienst-neu-starten)

# Share mit Authentifizierung testen

auf dem **Server**:
```bash
smbclient //localhost/shared -N -U alice%tux
```

auf dem **Client**:
```bash
# Passwort direkt mitgeben:
smbclient //smb.example.net/shared -U alice%tux
# Passwort abfragen lassen:
smbclient //smb.example.net/shared -U alice
Password for [SAMBA\alice]:
Try "help" to get a list of possible commands.
smb: \>
```

# Mehr zu `smbclient`

einzelne Befehle direkt ausführen:
```bash
smbclient //smb.example.net/public -N -U% -c 'ls'
```

Datei im Share ablegen:
```bash
echo "Text für hallo" > hallo.txt
smbclient //smb.example.net/shared -U alice -c "put /home/tux/hallo.txt hallo.txt"
```

Inhalt einer Datei im Share anzeigen:
```bash
smb: \> more hallo.txt
```

Ordner anlegen:
```bash
smb: \> mkdir folder
```

Datei in Ordner verschieben:
```bash
smb: \> rename hallo.txt folder/hallo.txt
```

Daten vom Share zum Client kopieren:
```bash
smb: \> get remote.txt
```

Datei im Share löschen:
```bash
smb: \> del remote.txt
```

Übersicht aller Befehle erhalten:
```bash
smb: \> help
```

Smbclient schließen:
```bash
smb: \> quit
```

# Share einhängen

ohne Authentifizierung:
```bash
mount -t cifs -o guest //smb.example.net/public ~/public
```

zusätzlich mit Authentifizierung:
```bash
mount -t cifs -o username=alice,password=tux //smb.example.net/shared ~/shared
```

# Share in `/etc/fstab` eintragen

Ordner erstellen:
```bash
mkdir /mnt/shared
```

Zeile in `fstab`:
```bash
//smb.example.net/shared /mnt/shared cifs rw,auto,username=alice,password=tux 0 0
```

# Share aushängen

```bash
umount /mnt/public
```

# weitere Befehle

Überblick über den aktuellen Zustand des Samba-Servers:
```bash
smbstatus
```

alle Samba-User auflisten:
```bash
pdbedit -L
```

Details zu einem Samba-User anzeigen:
```bash
pdbedit -v alice
```

NetBIOS-Lookup:
```bash
nmblookup --status __SAMBA__
```
